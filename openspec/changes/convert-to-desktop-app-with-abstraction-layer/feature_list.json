{
  "change_id": "convert-to-desktop-app-with-abstraction-layer",
  "generated_at": "2026-02-21T16:38:55Z",
  "features": {
    "R1": {
      "category": "functional",
      "description": "梳理现有业务能力并定义 core 层边界与接口",
      "task_id": "1.1",
      "accept": "形成平台无关能力清单，并定义 `core` 对外接口（至少包含文档模型、渲染管线、查找替换、文件服务契约）",
      "test": "SCOPE: CLI\n- 运行静态检查验证 core 不直接依赖 DOM/Node/Electron API\n- 运行单元测试验证 core 接口契约可被 mock 实现替换",
      "steps": [
        "Run: SCOPE: CLI",
        "Run: - 运行静态检查验证 core 不直接依赖 DOM/Node/Electron API",
        "Run: - 运行单元测试验证 core 接口契约可被 mock 实现替换"
      ],
      "passes": true
    },
    "R2": {
      "category": "functional",
      "description": "抽离并迁移共享逻辑到 core 层",
      "task_id": "1.2",
      "accept": "现有前端版核心逻辑通过 core 层调用，原功能行为不回退",
      "test": "SCOPE: MIXED\n- CLI: 运行 `npm run test`，验证核心测试全部通过\n- GUI: 启动 Web 版本，执行 MCP runbook 验证编辑、预览、查找替换关键路径",
      "steps": [
        "Run: SCOPE: MIXED",
        "Run: - CLI: 运行 `npm run test`，验证核心测试全部通过",
        "Run: - GUI: 启动 Web 版本，执行 MCP runbook 验证编辑、预览、查找替换关键路径"
      ],
      "passes": false
    },
    "R3": {
      "category": "functional",
      "description": "实现 Web/Desktop 双平台 adapter",
      "task_id": "2.1",
      "accept": "`web` 与 `desktop` adapter 均实现统一接口，业务层无平台分支",
      "test": "SCOPE: CLI\n- 运行类型检查与 adapter 契约测试\n- 验证 adapter 替换时 core 测试可复用且通过",
      "steps": [
        "Run: SCOPE: CLI",
        "Run: - 运行类型检查与 adapter 契约测试",
        "Run: - 验证 adapter 替换时 core 测试可复用且通过"
      ],
      "passes": false
    },
    "R4": {
      "category": "functional",
      "description": "接入桌面壳并打通最小可用流程（打开、编辑、预览、保存）",
      "task_id": "2.2",
      "accept": "桌面应用可本地运行并完成文档打开、编辑、预览、保存、另存为、最近文件、拖拽打开闭环",
      "test": "SCOPE: GUI\n- 运行桌面应用启动脚本\n- 按 MCP runbook 完成文件打开、编辑保存、另存为、最近文件入口回放、拖拽打开校验\n- 重新打开文件并校验内容一致",
      "steps": [
        "Run: SCOPE: GUI",
        "Run: - 运行桌面应用启动脚本",
        "Run: - 按 MCP runbook 完成文件打开、编辑保存、另存为、最近文件入口回放、拖拽打开校验",
        "Run: - 重新打开文件并校验内容一致"
      ],
      "passes": false
    },
    "R5": {
      "category": "functional",
      "description": "建立 Web/Desktop 双端构建与验证脚本",
      "task_id": "3.1",
      "accept": "提供统一命令同时支持 Web 构建与桌面打包，失败时返回非零退出码",
      "test": "SCOPE: CLI\n- 运行 Web 构建命令并验证产物存在\n- 运行桌面打包命令并验证安装包或可执行产物生成",
      "steps": [
        "Run: SCOPE: CLI",
        "Run: - 运行 Web 构建命令并验证产物存在",
        "Run: - 运行桌面打包命令并验证安装包或可执行产物生成"
      ],
      "passes": false
    },
    "R6": {
      "category": "functional",
      "description": "增加双端一致性回归测试",
      "task_id": "3.2",
      "accept": "同一 Markdown 输入在 Web/Desktop 的渲染结果与关键编辑行为保持一致，且不缺失现有 Web 编辑能力",
      "test": "SCOPE: MIXED\n- CLI: 运行一致性测试脚本，比对核心输出快照或规则断言\n- GUI: 按 MCP runbook 在双端执行关键操作并记录截图证据点",
      "steps": [
        "Run: SCOPE: MIXED",
        "Run: - CLI: 运行一致性测试脚本，比对核心输出快照或规则断言",
        "Run: - GUI: 按 MCP runbook 在双端执行关键操作并记录截图证据点"
      ],
      "passes": false
    },
    "R7": {
      "category": "functional",
      "description": "增加首次渲染时间采集与门禁",
      "task_id": "3.3",
      "accept": "在 Web 与 Desktop 运行中可采集首次渲染时间，并在测试中输出可审计结果",
      "test": "SCOPE: CLI\n- 运行性能采集脚本并输出首屏渲染耗时日志\n- 若阈值未确定，按基线对比策略输出“未退化”判定结果",
      "steps": [
        "Run: SCOPE: CLI",
        "Run: - 运行性能采集脚本并输出首屏渲染耗时日志",
        "Run: - 若阈值未确定，按基线对比策略输出“未退化”判定结果"
      ],
      "passes": false
    }
  }
}
