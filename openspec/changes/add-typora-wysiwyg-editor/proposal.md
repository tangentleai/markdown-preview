# Change: 添加 Typora 风格所见即所得 Markdown 编辑模式

## Why
当前项目以“源码输入 + 预览渲染”为主，无法满足“在排版结果上直接编辑”的核心诉求。引入 Typora 核心体验可显著降低写作心智负担，并提升长文档编辑效率。

## What Changes
- 在现有双栏基础上新增 WYSIWYG 模式开关，支持“双栏预览模式 / 单栏所见即所得模式”切换。
- 引入结构化文档模型，定义 Markdown 导入与导出的双向等价规则。
- 增加输入规则（`#`、`-`、`1.`、`>`、代码块、行内样式）与可逆编辑行为。
- 增加文件能力：打开、保存、另存为（MVP 采用最小化文件流程），确保 UTF-8 Markdown 序列化一致性。
- 增加基础编辑体验：撤销/重做、查找替换、快捷键、IME 友好输入。
- 增加辅助能力：标题大纲实时生成与跳转、图片拖拽插入图片引用（MVP 不做资源复制）。

## Success Metrics
- MVP 功能完整性：核心 DoD 场景（标题/列表/引用/代码块/粘贴/打开保存/大纲/快捷键）可稳定复现。
- 一致性：`打开 -> 编辑 -> 保存 -> 重开` 后文档结构语义保持一致。
- 可用性：双栏与 WYSIWYG 模式切换过程中，不出现数据丢失或结构破坏。

## Impact
- Affected specs: `wysiwyg-markdown-editor`（新增）
- Affected code:
  - `src/` 编辑器核心与文档模型相关模块（新增）
  - 文件读写与状态管理模块（新增/调整）
  - 大纲与资源管理模块（新增）
  - 对应单元测试、交互测试与 round-trip 测试（新增）

## Rollout / Rollback
- Rollout: 先以“模式开关”方式引入 WYSIWYG，不替换现有双栏默认路径。
- Rollback: 若出现编辑稳定性问题，可仅关闭 WYSIWYG 入口并继续使用既有双栏模式。

## In Scope
- MVP P0：保留双栏并新增 WYSIWYG 模式开关、核心 Markdown 语法、打开/保存/另存为、撤销重做、查找替换（普通文本）、图片拖拽引用、大纲导航。
- P1 规划：自动保存恢复、HTML 粘贴转换、更完整表格编辑、标记符隐藏策略增强。

## Out of Scope
- PDF/Word 导出、站点发布、Git 同步。
- 多标签复杂工作区、云同步、协作编辑。
- Mermaid/PlantUML/数学公式/脚注等高级扩展编辑能力（后续变更处理）。
- 查找替换正则能力（后续变更处理）。

## Risks & Mitigations
- 光标映射与输入规则冲突：采用事务化输入规则并做 IME 组合输入保护。
- Markdown 双向转换漂移：定义统一序列化规范并引入 round-trip 回归集。
- 大文档性能退化：设定分层渲染与延迟更新策略，保留降级机制。

## Open Questions
- 编辑器内核不预设，按任务 1.1 的选型标准（Markdown round-trip、IME 稳定性、输入规则可控性）确定最终方案。
