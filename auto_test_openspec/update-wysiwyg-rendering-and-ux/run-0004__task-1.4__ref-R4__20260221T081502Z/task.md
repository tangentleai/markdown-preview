# Task Validation Bundle (RUN #4)

- change-id: `update-wysiwyg-rendering-and-ux`
- run#: `0004`
- task-id: `1.4`
- ref-id: `R4`
- scope: `CLI`

## Task Target

Implement only task `1.4 [#R4]`: optimize continuous math formula editing performance in WYSIWYG by applying debounce/rate-limiting to reduce repeated renders, and keep observed main-thread long tasks under `50ms`.

## How To Run

- macOS/Linux:
  - `bash auto_test_openspec/update-wysiwyg-rendering-and-ux/run-0004__task-1.4__ref-R4__20260221T081502Z/run.sh`
- Windows:
  - `auto_test_openspec\update-wysiwyg-rendering-and-ux\run-0004__task-1.4__ref-R4__20260221T081502Z\run.bat`

## Test Assets

- CLI entry scripts: `run.sh`, `run.bat`
- CLI test scripts: `tests/test_cli_math_performance.sh`, `tests/test_cli_math_performance.bat`
- startup log: `logs/worker_startup.txt`
- run transcript: `logs/run.log`
- CLI output evidence: `outputs/cli-math-performance.log`

## Inputs / Outputs

- Inputs:
  - Benchmark formula samples are generated in `src/__tests__/mathRenderingPerformance.test.ts` using indexed `MOM` variants to simulate continuous edits.
- Outputs:
  - Full CLI evidence log: `outputs/cli-math-performance.log`
  - Runner transcript and exit code: `logs/run.log`

## Expected Results (Machine-Decidable)

`run.sh` / `run.bat` MUST run `npm test -- mathRenderingPerformance.test.ts` through `tests/test_cli_math_performance.*` and satisfy all checks below:

1. Command exit code is `0`.
2. Test `should debounce continuous formula edits into fewer render passes` passes (proof of debounce/rate-limit behavior).
3. Test `should keep block math render tasks below the long-task threshold` passes.
4. In test assertions, measured `maxDurationMs` is strictly less than `50ms` (`MATH_LONG_TASK_THRESHOLD_MS`).

## Provenance

- Debounce and threshold values are derived from this change's ACCEPT criteria and design constraints for R4.
- Benchmark samples and assertions are generated by worker implementation for reproducible CLI validation.
